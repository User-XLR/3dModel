# IFC 模型特殊标注功能

## 功能概述

本功能为 IFC 模型渲染后，自动检测并标注 Tag 值为"975903"的结构信息对象，提供特殊的视觉标注和信息显示。

## 功能特性

### 1. 自动检测

- 在 IFC 模型加载完成后，自动扫描整个模型
- 查找所有 Tag 属性值为"975903"的对象
- 在控制台输出检测结果

### 2. 视觉标注

- 为特殊对象应用红色半透明高亮材质
- 标注对象在 3D 场景中明显可见
- 保持原有的选择和高亮功能

### 3. 信息显示

- 在属性面板中显示特殊标注信息
- 右上角显示特殊标注面板，列出所有标注对象
- 包含对象的详细信息：Tag、名称、类型、UUID 等

## 使用方法

### 1. 加载 IFC 模型

```javascript
// 模型加载后会自动扫描特殊对象
viewer.loadIfc('path/to/model.ifc', options)
```

### 2. 查看特殊标注

- 在 3D 场景中，Tag 为"975903"的对象会显示红色高亮
- 点击对象可在属性面板中看到特殊标注信息
- 右上角的特殊标注面板显示所有标注对象的列表

### 3. 手动扫描

```javascript
// 手动触发扫描（如果需要重新扫描）
viewer.scanAndAnnotateSpecialObjects(ifcModel)
```

## 技术实现

### 核心方法

#### `scanAndAnnotateSpecialObjects(ifcModel)`

扫描 IFC 模型中的所有对象，查找 Tag 值为"975903"的对象并添加标注。

#### `createSpecialAnnotationForObject(ifcModel, objectId, props)`

为指定的 IFC 对象创建特殊标注，包括：

- 创建红色高亮材质
- 添加标注信息到 userData
- 触发特殊标注事件

#### `addSpecialAnnotation(object, props)`

为选中的 IFC 对象添加特殊标注（当 Tag 值为"975903"时）。

### 事件系统

#### 特殊标注事件

```javascript
// 监听特殊标注事件
window.addEventListener('specialAnnotation', event => {
  const { object, properties } = event.detail
  // 处理特殊标注信息
})
```

### 组件结构

#### SpecialAnnotationPanel

- 位置：右上角固定面板
- 功能：显示所有特殊标注对象的列表
- 特性：可删除单个标注、清空所有标注

#### PropertyPanel 增强

- 在属性面板中显示特殊标注信息
- 当对象有特殊标注时，显示"🔴 特殊标注"条目

## 配置选项

### 标注材质配置

```javascript
const specialMaterial = new THREE.MeshPhongMaterial({
  color: 0xff0000, // 红色
  depthTest: false, // 始终显示在前面
  transparent: true, // 半透明
  opacity: 0.5 // 透明度
})
```

### 扫描配置

- 扫描延迟：1 秒（确保模型完全加载）
- 扫描范围：所有 IFC 对象类型
- 错误处理：忽略无法获取属性的对象

## 注意事项

1. **性能考虑**：扫描大型 IFC 模型可能需要一些时间，建议在模型加载完成后进行
2. **内存使用**：每个特殊标注都会创建额外的材质和几何体
3. **兼容性**：需要支持 IFC 格式的 Three.js IFC 加载器
4. **错误处理**：扫描过程中会忽略无法获取属性的对象，避免程序崩溃

## 扩展功能

### 自定义 Tag 值

可以通过修改代码中的"975903"为其他值来支持不同的特殊标注需求。

### 多种标注类型

可以扩展支持多种 Tag 值的不同标注样式：

- 不同颜色
- 不同透明度
- 不同标注图标

### 批量操作

可以添加批量操作功能：

- 批量删除标注
- 批量修改标注样式
- 导出标注信息

## 故障排除

### 常见问题

1. **扫描无结果**

   - 检查 IFC 模型是否包含 Tag 值为"975903"的对象
   - 确认 IFC 加载器正常工作
   - 查看浏览器控制台的错误信息

2. **标注不显示**

   - 检查材质设置是否正确
   - 确认对象几何体存在
   - 验证场景渲染正常

3. **性能问题**
   - 考虑减少扫描频率
   - 优化材质和几何体创建
   - 使用更高效的扫描算法

### 调试信息

在浏览器控制台中可以看到详细的调试信息：

- 扫描开始和结束提示
- 发现的特殊对象数量
- 每个特殊对象的详细信息
- 标注创建的成功/失败状态
